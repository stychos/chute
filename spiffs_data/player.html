<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ESP32-CAM Player</title>
    <link rel="stylesheet" href="/common.css">
</head>
<body>
    <nav class="navbar">
        <a class="brand" href="/">ESP32-CAM</a>
        <a href="/" class="active">Player</a>
        <a href="/settings">Settings</a>
        <a href="/camera">Camera</a>
    </nav>
    <div class="container" style="text-align:center;">
        <h1 class="page-title">ESP32-CAM Player</h1>
        <div id="player">
            <div id="placeholder">Stopped</div>
            <img id="vid" alt="Video">
            <audio id="aud" controls></audio>
        </div>
        <div class="controls">
            <label class="radio"><input type="radio" name="mode" value="video" checked onchange="switchMode('video')">Video</label>
            <label class="radio"><input type="radio" name="mode" value="audio" onchange="switchMode('audio')">Audio</label>
            <label class="radio"><input type="radio" name="mode" value="combined" onchange="switchMode('combined')">Combined</label>
        </div>
        <button id="btn" onclick="togglePlay()">Play</button>
    </div>
    <script>
    var playing=false, mode='video', vUrl='', aUrl='';
    var vid=document.getElementById('vid'), aud=document.getElementById('aud'),
        ph=document.getElementById('placeholder'), btn=document.getElementById('btn');

    fetch('/api/info').then(function(r){return r.json();}).then(function(d){
        var host = location.hostname;
        vUrl = 'http://'+host+':'+d.stream_port+'/stream';
        aUrl = 'http://'+host+':'+d.audio_port+'/audio';
    });

    function stop(){
        vid.src=''; vid.style.display='none';
        aud.pause(); aud.src=''; aud.style.display='none';
        ph.style.display='flex'; playing=false; btn.textContent='Play';
    }
    function play(){
        ph.style.display='none';
        if(mode==='video'||mode==='combined'){vid.src=vUrl;vid.style.display='block';}else{vid.src='';vid.style.display='none';}
        if(mode==='audio'||mode==='combined'){aud.src=aUrl;aud.style.display='block';aud.play();}else{aud.pause();aud.src='';aud.style.display='none';}
        playing=true; btn.textContent='Stop';
    }
    function togglePlay(){ playing?stop():play(); }
    function switchMode(m){ mode=m; if(playing){stop();play();} }
    </script>
</body>
</html>
